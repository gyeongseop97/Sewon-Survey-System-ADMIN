<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sewon Survey System(ADMIN)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
  <div class="brand">
      <div class="logo">SSS</div>
      <div class="title">
        <div class="h1">Sewon Survey System (admin)</div>
        <div class="sub">세원 평가 설문 시스템 (관리자용)</div>
      </div>
    </div>
  <div class="top-center" aria-label="설문 작업 메뉴">
    <!-- ✅ 바로가기 메뉴 -->
      <button class="btn ghost nav-btn" data-view="manage" type="button">설문 관리</button>
      <button class="btn ghost nav-btn active" data-view="edit" type="button">설문 수정</button>
      <button class="btn ghost nav-btn" data-view="rules" type="button">문항 비활성화 룰 설정</button>
      <button class="btn ghost nav-btn" data-view="score" type="button">채점 시뮬레이터</button>
      <button class="btn ghost nav-btn" data-view="preview" type="button">설문 미리보기</button>
  </div>
  <div class="top-actions" aria-label="파일 작업">
    <!-- 기존 버튼 -->
      <button class="btn" id="btnNew" type="button">새 설문</button>
      <label class="btn ghost" style="margin:0;">
        설문 불러오기
        <input type="file" id="fileImportXls" accept=".xls,.xml" hidden />
      </label>
      <button class="btn" id="btnExportXls" type="button">설문 내보내기</button>
<button class="btn" id="btnSaveServer" type="button">서버에 저장</button>
  </div>
</header>

  <main class="layout">
    <aside class="sidebar">
      <div class="panel tone-1">
        <div class="panel-title">설문 정보</div>
        <div class="field">
          <label>제목</label>
          <input id="surveyTitle" type="text" placeholder="예: 협력사 ESG 평가" />
        </div>
        <div class="field">
          <label>버전</label>
          <input id="surveyVersion" type="text" placeholder="예: v1.0" />
        </div>
        <div class="row">
          <button class="btn small" id="btnValidate" type="button">가중치 검증</button>
        </div>
        <div class="hint" id="overview"></div>
      </div>

      <div class="panel tone-3" id="pointsPanel" style="display:none;">
        <div class="panel-title">배점 합계</div>
        <div class="points-meter" id="pointsMeter">0/100점</div>
        <div class="hint" id="pointsHint">구분2에서 “개별 배점”을 선택하면 합계가 표시됩니다.</div>
      </div>

<div class="panel tone-2">
  <div class="panel-title with-actions">
    <span>구성 트리</span>
    <button class="btn small ghost" id="btnExpand" type="button">전체 펼치기</button>
  </div>

  <div class="tree" id="tree"></div>

  <div class="row">
    <button class="btn small" id="addG1" type="button">+ 구분1</button>
  </div>
</div>

    </aside>

    <!-- ✅ 우측: View 전환 구조 -->
    <section class="canvas">

      <!-- (0) 설문 관리 (서버) -->
      <section class="view view-manage">
        <div class="canvas-header">
          <div class="canvas-header-left">
            <div class="h2">설문 관리</div>
            <div class="hint">내 계정(관리자)이 만든 설문 리스트 / 편집 / 제출 답변 조회</div>
          </div>
          <div class="canvas-header-actions" data-header-actions>
            <button class="btn small" id="btnSrvCreate" type="button">현재 설문을 서버에 새로 저장</button>
            <button class="btn small ghost" id="btnSrvUpdate" type="button">현재 설문을 서버에 업데이트</button>
            <button class="btn small ghost" id="btnSrvRefresh" type="button">목록 새로고침</button>
          </div>
        </div>

        <div class="panel tone-1" style="margin:0 0 12px 0;">
          <div class="hint" id="srvStatus">서버 연결 상태를 확인 중…</div>
        </div>

        <div class="panel" style="margin:0;">
          <div class="panel-title">내 설문 리스트</div>
          <div class="hint" style="margin-bottom:10px;">※ 편집 버튼을 누르면 해당 설문을 로컬 편집 화면으로 불러옵니다.</div>
          <div class="table-wrap">
            <table class="tbl" id="tblSurveys">
              <thead>
                <tr>
                  <th style="width:60px;">NO</th>
                  <th>설문지 이름</th>
                  <th style="width:140px;">설문지 코드</th>
                  <th style="width:120px;">편집</th>
                  <th style="width:170px;">제출된 답변 보기</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="panel" style="margin-top:12px; display:none;" id="respPanel">
          <div class="panel-title" id="respTitle">제출된 답변</div>
          <div class="hint" id="respHint" style="margin-bottom:10px;"></div>
          <div class="table-wrap">
            <table class="tbl" id="tblResponses">
              <thead>
                <tr>
                  <th style="width:60px;">NO</th>
                  <th style="width:260px;">user_id</th>
                  <th style="width:200px;">submitted_at</th>
                  <th>내용</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- (1) 설문 수정 -->
      <section class="view view-edit active">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2" id="canvasTitle">설문 수정</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <div id="editor" class="editor"></div>
      </section>

      <!-- (2) 문항 비활성화 룰 설정 -->
      <section class="view view-rules">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2">문항 비활성화 룰 설정</div>
            <div class="hint">특정 문항 응답(YES/NO/NA)에 따라 구분2를 비활성화합니다.</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <!-- 기존 룰 UI가 있으면 여기에 렌더링 -->
        <div id="rulesRoot"></div>
      </section>

      <!-- (3) 채점 시뮬레이터 -->
      <section class="view view-score">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2">채점 시뮬레이터</div>
            <div class="hint">관리자용 점수 계산/검증을 수행합니다.</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <!-- 기존 시뮬레이터 UI가 있으면 여기에 렌더링 -->
        <div id="scoreRoot"></div>
      </section>

      <!-- (4) 설문 미리보기 -->
      <section class="view view-preview">
        <div class="preview">
          <div class="h2">설문 미리보기</div>
          <div class="hint">실제 응답자용 UI는 별도 프로그램에서 이 설문을 읽어 렌더링합니다.</div>
          <div id="preview"></div>
        </div>
      </section>

    </section>
  </main>

  <footer class="footer">
    <div>© Sewon Survey Management System (local)</div>
    <div class="muted">온라인 운영용</div>
  </footer>
  
<!-- Supabase SDK (user_app.js보다 위에 있어야 함) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  
<!-- Auth Modal -->
<div id="authBackdrop" class="auth-backdrop hidden">
  <div class="auth-card">
    <div class="auth-title">로그인</div>
    <div class="auth-sub">이메일과 비밀번호를 입력해 주세요.</div>

    <div class="auth-row">
      <label>이메일</label>
      <input id="authEmail" type="email" placeholder="example@company.com" />
    </div>
    <div class="auth-row">
      <label>비밀번호</label>
      <input id="authPassword" type="password" placeholder="••••••••" />
    </div>

    <div id="authError" class="auth-error"></div>

    <div class="auth-actions">
      <button class="btn ghost" id="btnAuthSignUp" type="button">회원가입</button>
      <button class="btn primary" id="btnAuthLogin" type="button">로그인</button>
    </div>
  </div>
</div>
  <script src="./app.js"></script>
</body>
</html>
