<!doctype html>
<html lang="ko">
<head>
<link rel="icon" href="adminicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sewon Survey System(ADMIN)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
  <div class="brand">
<div class="logo">
  <img src="adminicon.ico" alt="logo">
</div>
      <div class="title">
        <div class="h1">Sewon Survey System (admin)</div>
        <div class="sub">세원 평가 설문 시스템 (관리자용)</div>
      </div>
    </div>
  <div class="top-center" aria-label="설문 작업 메뉴">
    <!-- ✅ 바로가기 메뉴 -->
      <button class="btn ghost nav-btn" data-view="manage" type="button">설문 관리</button>
      <button class="btn ghost nav-btn active" data-view="edit" type="button">설문 수정</button>
      <button class="btn ghost nav-btn" data-view="rules" type="button">문항 비활성화 룰 설정</button>
      <button class="btn ghost nav-btn" data-view="score" type="button">채점 시뮬레이터</button>
      <button class="btn ghost nav-btn" data-view="preview" type="button">설문 미리보기</button>
  </div>
  <div class="top-actions" aria-label="파일 작업">
    <!-- 기존 버튼 -->
      <button class="btn" id="btnNew" type="button">새 설문</button>
      <label class="btn ghost" style="margin:0;">
        엑셀로 설문 불러오기
        <input type="file" id="fileImportXls" accept=".xls,.xml" hidden />
      </label>
      <button class="btn" id="btnExportXls" type="button">엑셀로 설문 내보내기</button>
      <button class="btn" id="btnSaveServer" type="button">서버에 설문 저장</button>
      <button class="btn danger" id="btnLogout" type="button">로그아웃</button>

  </div>
</header>

  <main class="layout">
    <aside class="sidebar">
      <div class="panel tone-1">
        <div class="panel-title">설문 정보</div>
        <div class="field">
          <label>제목</label>
          <input id="surveyTitle" type="text" placeholder="예: 협력사 ESG 평가" />
        </div>
        <div class="row">
          <button class="btn small" id="btnValidate" type="button">가중치 검증</button>
        </div>
        <div class="hint" id="overview"></div>
      </div>

      <div class="panel tone-3" id="pointsPanel" style="display:none;">
        <div class="panel-title">배점 합계</div>
        <div class="points-meter" id="pointsMeter">0/100점</div>
        <div class="hint" id="pointsHint">구분2에서 “개별 배점”을 선택하면 합계가 표시됩니다.</div>
      </div>

<div class="panel tone-2">
  <div class="panel-title with-actions">
    <span>구성 트리</span>
    <button class="btn small ghost" id="btnExpand" type="button">전체 펼치기</button>
  </div>

  <div class="tree" id="tree"></div>

  <div class="row">
    <button class="btn small" id="addG1" type="button">+ 구분1</button>
  </div>
</div>

    </aside>

    <!-- ✅ 우측: View 전환 구조 -->
    <section class="canvas">
<!-- (0) 설문 관리 -->
<section class="view view-manage">
  <div class="canvas-header">
    <div class="canvas-header-left">
      <div class="h2">설문 관리</div>
      <div class="hint">내 계정(관리자)이 만든 설문 리스트 / 편집 / 제출 답변 조회</div>
    </div>
    <div class="canvas-header-actions" data-header-actions></div>
  </div>

  <div id="manageRoot">
    <div class="card" style="padding:14px;">
      <div class="h3" style="margin-bottom:8px;">내 설문 리스트</div>

      <table class="table" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th style="text-align:left; padding:10px;">NO</th>
            <th style="text-align:left; padding:10px;">설문지 이름</th>
            <th style="text-align:left; padding:10px;">설문지 코드</th>
            <th style="text-align:left; padding:10px;">설문 기간</th>
            <th style="text-align:left; padding:10px;">편집</th>
            <th style="text-align:left; padding:10px;">제출된 답변 보기</th>
<th style="text-align:left; padding:10px;">삭제</th>

          </tr>
        </thead>
        <tbody id="mySurveyTbody">
          <tr>
<td colspan="7" style="padding:12px; color:#6b7280;">아직 불러온 데이터가 없습니다.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
<!-- ===== Submitted Answers View ===== -->
<section class="view view-answers">
  <div class="card">
    <div class="card-head">
      <div>
        <h2>제출된 답변 보기</h2>
        <p id="submittedSurveyTitle" class="muted">-</p>
      </div>
      <div class="actions">
        <button id="btnAnswersBack" class="btn">← 뒤로</button>
      </div>
    </div>

    <div class="card-body">
      <table class="tbl">
        <thead>
          <tr>
            <th style="width:70px;">NO</th>
            <th>회사명</th>
            <th>이름</th>
            <th>아이디</th>
            <th style="width:120px;">제출 점수</th>
            <th style="width:110px;">편집</th>
            <th style="width:140px;">답변 다운로드</th>
	<th style="width:140px;">결과 다운로드</th>

          </tr>
        </thead>
        <tbody id="submittedTbody"></tbody>
      </table>
    </div>
  </div>
</section>

      <!-- (1) 설문 수정 -->
      <section class="view view-edit active">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2" id="canvasTitle">설문 수정</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <div id="editor" class="editor"></div>
      </section>

      <!-- (2) 문항 비활성화 룰 설정 -->
      <section class="view view-rules">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2">문항 비활성화 룰 설정</div>
            <div class="hint">특정 문항 응답(YES/NO/NA)에 따라 구분2를 비활성화합니다.</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <!-- 기존 룰 UI가 있으면 여기에 렌더링 -->
        <div id="rulesRoot"></div>
      </section>

      <!-- (3) 채점 시뮬레이터 -->
      <section class="view view-score">
        <div class="canvas-header">
  <div class="canvas-header-left">
            <div class="h2">채점 시뮬레이터</div>
            <div class="hint">관리자용 점수 계산/검증을 수행합니다.</div>
          </div>
    <div class="canvas-header-actions" data-header-actions></div>
        </div>

        <!-- 기존 시뮬레이터 UI가 있으면 여기에 렌더링 -->
        <div id="scoreRoot"></div>
      </section>

      <!-- (4) 설문 미리보기 -->
      <section class="view view-preview">
        <div class="preview">
          <div class="h2">설문 미리보기</div>
          <div class="hint">실제 응답자용 UI는 별도 프로그램에서 이 설문을 읽어 렌더링합니다.</div>
          <div id="preview"></div>
        </div>
      </section>
  </main>

  <footer class="footer">
    <div>© Sewon Survey Management System (local)</div>
    <div class="muted">온라인 운영용</div>
  </footer>
  
<!-- Supabase SDK (user_app.js보다 위에 있어야 함) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  
<!-- Auth Modal -->
<div id="authBackdrop" class="auth-backdrop hidden" aria-hidden="true">
  <div class="auth-card" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="auth-head">
      <div>
        <div id="authTitle" class="auth-title">로그인</div>
        <div id="authSub" class="auth-sub">아이디(이메일)와 비밀번호를 입력해 주세요.</div>
      </div>
    </div>
<!-- 공통: 아이디/비번 -->
    <div class="auth-grid">
      <div class="auth-row">
        <label>아이디(이메일) <span class="req">*</span></label>
        <input id="authEmail" type="email" placeholder="example@company.com" autocomplete="email" />
      </div>

      <div class="auth-row">
        <label>비밀번호 <span class="req">*</span></label>
        <input id="authPassword" type="password" placeholder="••••••••" autocomplete="current-password" />
      </div>

      <!-- 회원가입 전용 -->
      <div id="signupOnly" class="signup-only hidden">
        <div class="auth-row">
          <label>비밀번호 확인 <span class="req">*</span></label>
          <input id="authPassword2" type="password" placeholder="••••••••" autocomplete="new-password" />
        </div>

        <div class="auth-row">
          <label>회원 구분 <span class="req">*</span></label>
          <select id="authUserType">
            <option value="" selected disabled>선택해 주세요</option>
            <option value="세원 임직원">세원 임직원</option>
            <option value="협력업체">협력업체</option>
            <option value="기타">기타</option>
          </select>
        </div>

        <div class="auth-row">
          <label>회사명 <span class="req">*</span></label>
          <input id="authCompany" type="text" placeholder="예: 세원정공" />
        </div>

        <div class="auth-row">
          <label>이름 <span class="req">*</span></label>
          <input id="authName" type="text" placeholder="홍길동" />
        </div>

        <div class="auth-row">
          <label>사번 (선택)</label>
          <input id="authEmpNo" type="text" placeholder="예: 12345" />
        </div>
      </div>
    </div>

    <div id="authError" class="auth-error"></div>

    <div class="auth-actions">
      <!-- 좌: 모드 전환 -->
      <button class="btn ghost" id="btnAuthToggle" type="button">회원가입</button>
  <button class="btn ghost" id="btnAuthForgot" type="button">비밀번호 찾기</button>
      <!-- 우: 실행(로그인/회원가입) -->
      <button class="btn primary" id="btnAuthSubmit" type="button">로그인</button>
    </div>
  </div>
</div>
  <!-- Admin Access Block Overlay -->
<div id="adminBlockOverlay" class="admin-block hidden" aria-hidden="true">
  <div class="admin-block-card" role="dialog" aria-modal="true" aria-labelledby="adminBlockTitle">
    <div id="adminBlockTitle" class="admin-block-title">관리자 권한이 없습니다.</div>
    <div id="adminBlockMsg" class="admin-block-msg">
      현재 로그인된 계정은 관리자용 프로그램을 사용할 수 없습니다. 사용자용 프로그램을 이용해 주세요.
    </div>
    <div class="admin-block-actions">
      <button class="btn" id="btnAdminBlockOk" type="button">확인</button>
    </div>
  </div>
</div>

<script src="./app.js"></script>
</body>
</html>